# 配置设计
配置五元组
- application：应用标识（唯一）
- env：环境，有dev、test、staging、prod
- group：分组，将配置进行分组，默认为default
- key：配置项名称
- version：版本，配置的版本，从1开始递增

application：初始化Client时传入

env：初始化Client时传入

group：获取配置时传入，不传默认为default分组

key：获取配置时传入

version：最新版本


# 功能设计
## Http接口
- 分组增删改查
- 配置增删改查
- 管理员增删改查
- 接口加密：增删改接口RSA加密（需要提前配置公钥私钥）

## 推拉模式
- Http长轮询
- 基于zookeeper监听

## 监听配置变化
- Listener 异步调用
- 重试机制

## 操作记录
- 配置增、删、改、查
- 分组增、删、改、查

## 配置格式校验
JSON、YAML等格式校验

## 配置自检
判断配置推送成功

## 配置回滚
选择历史版本中的一项回滚，回滚后在原有版本号上递增一位（类似Git的revert）

## 权限管理
超级管理员
- 新增、修改、删除application

管理员权限
- 新增、修改、删除自己应用的配置
- 新增、修改、删除自己应用的配置
- 为自己应用新增、修改、删除管理员

非管理员权限
- 查询配置

# 存储设计
## ZooKeeper
ZooKeeper特点：用于保证强一致性，代价是写入速度慢，只适合存储元数据。

使用ZooKeeper存储配置，存储格式：/config/{application}/{env}/{group}/{name}-{version}

## MySQL
MySQL存储操作记录、权限数据等。

1.管理员表
```sql
CREATE TABLE `dcc_admin` (
  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT '表自增主键',
  `application` varchar(50) NOT NULL UNIQUE COMMENT '应用配置空间',
  `admin_type` tinyint(2) NOT NULL DEFAULT '0' COMMENT '管理员类型',
  `admin_id` varchar(20) DEFAULT NULL COMMENT '管理员标识',
  `created_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='管理员表';
```

2.操作记录表
```sql
CREATE TABLE `dcc_record` (
  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT '表自增主键',
  `record_type` tinyint(2) NOT NULL DEFAULT '0' COMMENT '操作类型',
  `application` varchar(50) NOT NULL UNIQUE COMMENT '应用配置空间',
  `created_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='管理员表';
```

## 缓存
Redis：缓存热点配置

# 定时任务
方案不完善，可能会使用到
```xml
<dependency>
    <groupId>org.quartz-scheduler</groupId>
    <artifactId>quartz</artifactId>
    <version>${quartz.version}</version>
</dependency>
```
主要用于移动ZooKeeper中不是最新版本的配置到MySQL中存储。